<script src="/js/freeze-table.js"></script>
<style>
    th {
        font-weight: normal;
    }
</style>
<div class="alert alert-warning hidden" id="warn" role="alert"></div>
<!-- Begin:&Uni_obj -->
<div id="controls" style="z-index: 99; position: relative;" class="controls hidden t9n">
    <div class="controls-left">
        <a class="display-{CREATE_GRANTED}" onclick="$('#add').toggleClass('hidden');$('#controls').toggleClass('hidden');byId('t{TYP}').focus()" title="<t9n>[RU]Добавить[EN]Create</t9n>"><img class="icon8 icon8-0" src="https://img.icons8.com/ios/30/6495ED/plus.png"/></a>
        <a onclick="sendForm()" title="<t9n>[RU]Обновить[EN]Refresh</t9n>"><img class="icon8 icon8-0" src="https://img.icons8.com/ios/30/6495ED/refresh.png"/></a>
        <a onclick="tbCompact(false)" id="resize" class="hidden" title="<t9n>[RU]Просторный режим ячеек[EN]Broad cell mode</t9n>"><img class="icon8 icon8-0" src="https://img.icons8.com/ios/30/6495ED/resize.png"/></a>
        <a onclick="tbCompact(true)" id="collapse" title="<t9n>[RU]Компактный режим ячеек[EN]Compact cell mode</t9n>"><img class="icon8 icon8-0" src="https://img.icons8.com/ios/30/6495ED/collapse.png"/></a>
        <a onclick="if(byId('filter_row').classList.contains('hidden')) $('.filter_row').removeClass('hidden');else sendForm()" title="<t9n>[RU]Показать / применить фильтр[EN]Show / apply filter</t9n>"><img class="icon8 icon8-0" src="https://img.icons8.com/ios/30/6495ED/filter.png"/></a>
        <a href="/{_global_.z}/object/{ID}/?F_U={F_U}" title="<t9n>[RU]Очистить фильтр и сортировку[EN]Clear the filter and sort</t9n>"><img class="icon8 icon8-0" src="https://img.icons8.com/ios/30/6495ED/clear-filters.png"/></a>
        <a title="<t9n>[RU]Связи[EN]References</t9n>" onclick="byId('lnx').value=byId('lnx').value^1;sendForm()"><img class="icon8 icon8-{lnx}" src="https://img.icons8.com/ios/30/6495ED/flow-chart.png"/></a>
        <a title="<t9n>[RU]Компактный режим таблицы[EN]Compact table mode</t9n>" onclick="fun2('tb')"><img class="icon8 icon8-0" src="https://img.icons8.com/ios/30/6495ED/grid.png"/></a>
        <a title="<t9n>[RU]Не сокращать содержимое ячеек[EN]Display full cell content</t9n>" onclick="byId('full').value=byId('full').value?'':1;sendForm()"><img id="fullbtn" class="icon8 icon8-0" src="https://img.icons8.com/ios/30/6495ED/view-details.png"/></a>
        <!-- Begin:&EXPORT -->{OK}
            <a title="<t9n>[RU]Экспорт в файл CSV[EN]Export CSV format</t9n>" onclick="byId('exp').name='csv';sendForm()"><img class="icon8 icon8-0" src="https://img.icons8.com/ios/30/6495ED/export-csv.png"/></a>
            <a onclick="byId('exp').name='bki';sendForm()"><img class="icon8 icon8-0" src="https://img.icons8.com/ios/30/6495ED/database-export.png"/></a>
            <a title="<t9n>[RU]Импорт файла BKI[EN]Import BKI format</t9n>" onclick="$('#bki').toggleClass('hidden');$('#controls').toggleClass('hidden')"><img class="icon8 icon8-0" src="https://img.icons8.com/ios/30/6495ED/database-restore.png"/></a>
        <!-- End:&EXPORT -->
        <!-- Begin:&DELETE -->{OK}
            <a title="<t9n>[RU]Удалить записи, удовлетворяющие фильтру[EN]Delete the selection</t9n>" onclick="$('#controls').toggleClass('hidden');$('#confirm_del').toggleClass('hidden')"><img class="icon8 icon8-0" src="https://img.icons8.com/ios/30/6495ED/delete.png"/></a>
        <!-- End:&DELETE -->
    </div>
    
    <div class="controls-right">
        <a onclick="$('.settings').toggleClass('hidden')" title="<t9n>[RU]Настройки панели управления[EN]Control panel settings</t9n>"><img class="icon8 icon8-0" src="https://img.icons8.com/ios/30/6495ED/settings.png"/></a>
        <select id="icon8color" style="background-color:#6495ED" onchange="icon8color(this)" class="settings form-control hidden">
            <option style="background-color:#6495ED" value="6495ED">blue</option> 
            <option style="background-color:#2E8B57" value="2E8B57">green</option> 
            <option style="background-color:#B03060" value="B03060">bordo</option> 
            <option style="background-color:#777777" value="777777">light</option> 
            <option style="background-color:#333333" value="333333">gray</option> 
            <option style="background-color:#000000" value="000000">black</option> 
        </select>
        <select id="icon8" onchange="icon8(this.value)" class="settings form-control hidden">
        	<option value="ios">iOS</option>
        	<option value="ultraviolet">UV</option>
        	<option value="wired">cute</option>
        	<option value="windows">Win</option>
        	<option value="office">MSO</option>
        	<option value="dotty">Doty</option>
        	<option value="material-outlined">MD</option>
        </select>
    </div>
</div>
<!-- Begin:&Uni_obj_Parent --><div style="padding: 3px;"><A HREF="/{_global_.z}/object/{TID}/?F_U={UP}">{TYP}</A>: <A HREF="/{_global_.z}/edit_obj/{_parent_.F_U}">{NAME} ({_parent_.F_U})</A></div>
<!-- End:&Uni_obj_Parent -->
<TABLE id="bki" class="controls hidden">
	<TR>
		<TD>
        <FORM method="post" ENCTYPE="multipart/form-data" action="/{_global_.z}/object/{ID}">
        <input type="hidden" name="_xsrf" value="{_global_.xsrf}">
    	<input class="btn btn-sm" type="file" name="bki_file">
        <button name="import" class="btn btn-sm btn-primary"><t9n>[RU]Импорт[EN]Import</t9n>&nbsp;BKI</button>&nbsp;&nbsp;&nbsp;
        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="$('#controls').toggleClass('hidden'); $('#bki').toggleClass('hidden');">&nbsp;<t9n>[RU]Отменить[EN]Cancel</t9n>&nbsp;</button>
        </FORM>
        </td>
    </tr>
</table>
<TABLE id="confirm_del" class="controls hidden">
	<TR>
		<TD>
        <b><t9n>[RU]Подтвердите удаление[EN]Confirm to delete the records</t9n>&nbsp;&nbsp;&nbsp;&nbsp;</b>
        <button type="button" class="btn btn-sm btn-warning" onclick="byId('form').method='post';byId('exp').name='_m_del_select';sendForm('post')">&nbsp;<t9n>[RU]Да, удалить[EN]Yes, delete</t9n>&nbsp;</button>
        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="$('#controls').toggleClass('hidden'); $('#confirm_del').toggleClass('hidden');">&nbsp;<t9n>[RU]Отменить[EN]Cancel</t9n>&nbsp;</button>
        </td>
    </tr>
</table>
<div id="add" class="hidden">
<FORM method="post" action="/{_global_.z}/_m_new/{ID}" ONSUBMIT="addbtn.disabled = true; return true;">
<input type="hidden" name="_xsrf" value="{_global_.xsrf}">
<input type="hidden" name="up" value="{UP}">
<div class="input-group controls t9n" style="max-width:640px">
    <!-- Begin:&New_Req -->{NEW_REQ}
    	<input type="text" id="t{_parent_.TYP}" name="t{_parent_.TYP}" placeholder="{_parent_.VAL}" class="form-control">
    <!-- End:&New_Req -->
	<!-- Begin:&New_Req_REPORT_COLUMN -->
		<select id="t{_parent_.TYP}" name="t{_parent_.TYP}" class="form-control">{NEW_REQ}
			<!-- Begin:&Rep_Col_List -->
				<option value="{ID}">{VAL}</option>
			<!-- End:&Rep_Col_List -->
		</select>
	<!-- End:&New_Req_REPORT_COLUMN -->
	<!-- Begin:&New_Req_GRANT -->
		<select id="t{_parent_.TYP}" name="t{_parent_.TYP}" class="form-control">{NEW_REQ}
			<!-- Begin:&Grant_List -->
				<option value="{ID}">{VAL}</option>
			<!-- End:&Grant_List -->
		</select>
	<!-- End:&New_Req_GRANT -->
    <div class="input-group-append">
        <button type="submit" name="addbtn" class="btn btn-primary"><t9n>[RU]Добавить[EN]Create</t9n></button>
        <button class="btn btn-outline-secondary" onclick="$('#controls').toggleClass('hidden');$('#add').toggleClass('hidden');event.preventDefault();"><t9n>[RU]Отменить[EN]Cancel</t9n></button>
    </div>
</div>
</FORM>
</div>
<!-- Begin:&Warnings --><br/><div class="alert alert-danger" role="alert">{WARNING}</div>
<!-- End:&Warnings -->
<FORM id="form" class="freeze-table" method="get" ENCTYPE="multipart/form-data" action="/{_global_.z}/object/{ID}/?F_U={F_U}" onsubmit="sendForm()">
<div id="tableContainer">
<TABLE id="tb" class="table tb table-bordered">
    <thead>
    <tr>
		<!-- Begin:&Head_Ord_N -->
		<th BGCOLOR="#E8F4FC" ALIGN="center">{FILLER}N</th>
		<!-- End:&Head_Ord_N -->
		<th BGCOLOR="#E8F4FC" ALIGN="center" OnClick="$('.filter_row').toggleClass('hidden');"><A title="{ID}" colid="val" HREF="/{_global_.z}/object/{ID}/?{FILTER}&order_val=val" OnClick="event.stopPropagation();">{VAL}</A></th>
		<!-- Begin:&Uni_Obj_Head -->
		<th BGCOLOR="#E8F4FC" ALIGN="center" OnClick="$('.filter_row').toggleClass('hidden');"><A title="{TYP}" colid="{TYP}" HREF="/{_global_.z}/object/{ID}/?{FILTER}&order_val={TYP}" OnClick="event.stopPropagation();">{VAL}</A></th>
		<!-- End:&Uni_Obj_Head -->
		<!-- Begin:&Uni_Obj_Head_Links -->
		<th BGCOLOR="#E8F4FC" ALIGN="center" OnClick="$('.filter_row').toggleClass('hidden');"><A {VAL}><FONT COLOR="GRAY"><t9n>[RU]Связи[EN]References</t9n></FONT></A></th>
		<!-- End:&Uni_Obj_Head_Links -->
		<!-- Begin:&Head_Move_N_Delete -->
		<th BGCOLOR="#E8F4FC" OnClick="$('.filter_row').toggleClass('hidden');">{FILLER}&nbsp;</th>
		<!-- End:&Head_Move_N_Delete -->
	</tr>
    </thead>
    <tbody>
	<TR id="filter_row" class="filter_row hidden">
		<!-- Begin:&Head_Ord -->
		<th BGCOLOR="#E8F4FC" style="padding:0px;">{FILLER}&nbsp;</th>
		<!-- End:&Head_Ord -->
		<th BGCOLOR="#E8F4FC" style="padding:0px;" align="center"><!--{TYP}-->
			<!-- Begin:&Filter_Val_RCM -->
				<input type="text" name="{F_TYP}" value="{FILTER}" size="2" style="width:100%; ">
			<!-- End:&Filter_Val_RCM -->
			<!-- Begin:&Filter_Val_DNS -->
				<nobr><input type="text" name="{F_TYP_FR}" value="{FILTER_FR}" size="2" oninput="this.size=this.value.length+1">-</nobr><input type="text" name="{F_TYP_TO}" value="{FILTER_TO}" size="2" oninput="this.size=this.value.length+1">
			<!-- End:&Filter_Val_DNS -->
		</th>
		<!-- Begin:&Uni_Obj_Head_Filter --><!--{TYP}-->
		<TD BGCOLOR="#E8F4FC" style="padding:0px;" align="center">
			<!-- Begin:&Filter_Req_RCM -->
				<input type="text" name="{F_TYP}" id="{_parent_.REF}" value="{FILTER}" size="2" style="width:100%;" class="{_parent_.DD}"><ul id="dd{_parent_.REF}" class="dropdown-menu"><img style="margin:1px" width="25px" src="/i/ajax.gif"></ul>
			<!-- End:&Filter_Req_RCM -->
			<!-- Begin:&Filter_Req_DNS -->
				<nobr><input type="text" name="{F_TYP_FR}" value="{FILTER_FR}" size="1" oninput="this.size=this.value.length+1">-</nobr><input type="text" name="{F_TYP_TO}" value="{FILTER_TO}" size="1" oninput="this.size=this.value.length+1">
			<!-- End:&Filter_Req_DNS -->
		</TD>
		<!-- End:&Uni_Obj_Head_Filter -->
		<script>
		    $("input.dropdown-toggle").attr("data-toggle", "dropdown");
		    $("input.dropdown-toggle").attr("autocomplete", "off");
		    $("input.dropdown-toggle").focus(function(){refreshDD(this.id)});
		    $("input.dropdown-toggle").keyup(function(){refreshDD(this.id)});
		</script>
		<!-- Begin:&Uni_Obj_Head_Filter_Links --><!--{VAL}-->
		<TD BGCOLOR="#E8F4FC" style="padding:0px;">
			&nbsp;
		</TD>
		<!-- End:&Uni_Obj_Head_Filter_Links -->
		<!-- Begin:&Head_Move_N_Delete -->
		<TD BGCOLOR="#E8F4FC" style="padding:0px;">{FILLER}&nbsp;</TD>
		<!-- End:&Head_Move_N_Delete -->
	</TR>
	<!-- Begin:&Uni_Obj_All -->
	<TR>
		<!-- Begin:&Ord -->
		<th ALIGN="RIGHT">
			{ORD}
		</th>
		<!-- End:&Ord -->
		<th ALIGN="{ALIGN}" class="t9n"><A style="display:block" HREF="/{_global_.z}/edit_obj/{ID}" TITLE="<t9n>[RU]Редактировать[EN]Edit</t9n>">{VAL}</A></th>
		<!-- Begin:&Uni_Object_View_Reqs -->
		<TD ALIGN="{ALIGN}">{VAL}&nbsp;</TD>
		<!-- End:&Uni_Object_View_Reqs -->
		<!-- Begin:&Uni_Object_View_Reqs_Links -->
		<TD ALIGN="center">{VAL}
			<!-- Begin:&Reqs_Links --><A HREF="/{_global_.z}/object/{VALUE}/?lnx=1&F_{LINKS_TYP}=@{_parent_.ID}"><FONT SIZE="-2" COLOR="GRAY">{KEY}</FONT></A>&nbsp;<!-- End:&Reqs_Links -->&nbsp;
		</TD>
		<!-- End:&Uni_Object_View_Reqs_Links -->
		<!-- Begin:&Move_N_Delete -->
		<TD ALIGN="CENTER" class="t9n" style="padding:1px; white-space:nowrap;">
			<!-- Begin:&Move -->
			<A HREF="#" onclick="post('_m_up/{ID}')" TITLE="<t9n>[RU]Переместить выше[EN]Move up</t9n>"><img class="icon8 icon8-0" src="https://img.icons8.com/ios/25/222222/up.png"></A>
			<!-- End:&Move -->
			<A href="#" onclick="post('_m_del/{ID}/?up={_parent_.TYP}&f_u={_parent_.F_U}')" TITLE="<t9n>[RU]Удалить[EN]Delete</t9n>"><img class="icon8 icon8-0" src="https://img.icons8.com/ios/25/ee0000/delete-sign.png"></A>
		</TD>
		<!-- End:&Move_N_Delete -->
	</TR>
	<!-- End:&Uni_Obj_All -->
    <tbody>
</TABLE>
</div>
<!-- Begin:&No_Page -->
<p class="t9n"><span><t9n>[RU]Показаны не все записи. Показать[EN]Not all the records shown. Show</t9n>: <a href="/{_global_.z}/object/{ID}/?{lnx}&F_U={F_U}&f_show_all=1&pg=2"><t9n>[RU]следующие[EN]next</t9n> {LIMIT}</a>, <a href="/{_global_.z}/object/{ID}/?{lnx}&F_U={F_U}&f_show_all=1"><t9n>[RU]все[EN]all</t9n></a>.</span></p>
<br>
<!-- End:&No_Page -->
<!-- Begin:&Uni_Obj_Pages -->
<div class="p8n mt-2">
<span class="page-link">{ENDING}
</span><!-- Begin:&Page --><a class="page-link {CLASS}" <!-- Begin:&Page_Href -->href="/{_global_.z}/object/{ID}/?{FILTER}&pg={_parent_.PAGE}"<!-- End:&Page_Href -->> <span >{VAL}</span></a><!-- End:&Page -->
</div>
<!-- End:&Uni_Obj_Pages -->
<input type="hidden" name="F_I" value="{F_I}">
<input type="hidden" name="F_U" value="{F_U}">
<input type="hidden" id="exp" name="" value="1">
<input type="hidden" id="lnx" name="lnx" value="{LNX}">
<input type="hidden" id="full" name="full" value="">
<input type="hidden" id="order_val" name="order_val" value="">
<input type="hidden" id="desc" name="desc" value="">
<!-- Begin:_f_show_all -->
    <input type="hidden" name="f_show_all" value="{_request_.f_show_all}">
<!-- End:_f_show_all -->
<input type="hidden" name="_xsrf" value="{_global_.xsrf}">
<input type="submit" name="prompt" class="btn btn-sm btn-primary hidden">
</FORM>
<script>
if(search['full']!=undefined){
    byId('full').value=1;
    byId('fullbtn').classList.remove('icon8-0');
    byId('fullbtn').classList.add('icon8-1');
}
// Put the order mark on the column header 
if(search.order_val)$('a[colid='+search.order_val+']').prepend(search.desc?'&#9660; ':'&#9650; ');
if(search['order_val']!=undefined){
    byId('order_val').value=search['order_val'];
    if(search['desc']!=undefined)
        byId('desc').value=0;
}
var table = document.getElementById("tb");
// Remove empty inputs and input duplicates from cloned freeze-table objects
function sendForm(method){
    var dupes=[];
    $('#form').find('input, textearea, select').each(function(){
        if(this.value==''||(this.name=='_xsrf' && method!='post'))
            $(this).remove();
        if(dupes[this.name]!==undefined)
            $(this).remove();
        else
            dupes[this.name]=1;
    });
    byId('form').onsubmit='';
    byId('form').submit();
}
function icon8(v) {
    document.cookie = 'icon8='+v+'; path=/{_global_.z}; max-age=31622400'
    var iconsCollection = document.querySelectorAll('.icon8');
    iconsCollection.forEach(icon => {
        icon.attributes['src'].value = icon.attributes['src'].value.replace(/(img\.icons8\.com\/).+?(\/)/,'$1'+v+'$2')
    })
}
function icon8color(el) {
    el.style.backgroundColor='#'+el.value;
    document.cookie = 'icon8color='+el.value+'; path=/{_global_.z}; max-age=31622400'
    var iconsCollection = document.querySelectorAll('.icon8');
    iconsCollection.forEach(icon => {
        icon.attributes['src'].value = icon.attributes['src'].value.replace(/(\/30\/).{6,6}(\/)/,'$1'+el.value+'$2')
    })
    document.getElementById('controls').classList.contains('hidden') &&
        $('#controls').toggleClass('hidden')
}
function recalculateTable(mode) {
    let options = {
        'scrollBar': true,
        'shadow': true,
        'fixedNavbar': '.controls'
    }
    
    if (mode === 'compact') {
        options.freezeColumn = false;
    }
    $(function() {
        $('#tableContainer').freezeTable(options);
    });
}
function tbCompact(mode){
    if(mode){
        byId("tb").classList.add('table-sm');
        $('#collapse').toggleClass('hidden');
        $('#resize').toggleClass('hidden');
        document.cookie='table-sm=1; path=/{_global_.z}/object/{ID}; max-age=31622400';
        recalculateTable();
    }
    else{
        byId("tb").classList.remove('table-sm');
        $('#resize').toggleClass('hidden');
        $('#collapse').toggleClass('hidden');
        document.cookie='table-sm=1; path=/{_global_.z}/object/{ID}; max-age=0';
        recalculateTable();
    }
}
</script>
<!-- End:&Uni_obj -->
<script>
function myApi(m,u,b,vars,index){ // Параметры: метод, адрес, действие - ветка switch, параметры
    vars=vars||''; // По умолчанию список параметров пуст
    var h='',i,json,obj=new XMLHttpRequest(); // Объявляем переменную под JSON и API по HTTPS
    obj.open(m,'/'+db+'/'+u,true); // Открываем асинхронное соединение заданным методом по нужному адресу
    if(m=='POST'){ // Если это POST запрос, то передаем заданные параметры
        obj.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
        vars='_xsrf='+xsrf+'&'+vars; // добавляем токен xsrf, необходимый для POST-запроса
        obj.send(vars); // отправляем параметры
    }
    else
        obj.send(); // отправили запрос и теперь будем ждать ответ, а пока - выходим
    obj.onload=function(e){ // Когда запрос вернет результат - сработает эта функция
        try{ // в this.responseText лежит ответ от сервера
            json=JSON.parse(this.responseText); // Пытаемся разобрать ответ как JSON
        }
        catch(e){ // Если произошла ошибка при разборе JSON
            console.log(e); // то выводим детали этой ошибки в консоль браузера
            console.log(this.responseText);
        }
        obj.abort(); // Закрываем соединение
        switch(b){ // Отрабатываем заданную команду - переходим в соответствующую ветку case
            case 'def_ref_dd':
                if(json.object!==undefined){
                    var id=json.type.id;
                    for(i in json.object)
                        h+='<li class="p-2"><a onclick="byId('+id+').value=this.innerHTML;sendForm()">'+json.object[i].val+'</a></li>';
                    byId('dd'+id).innerHTML=h;
                    if($('#dd'+id).is(":hidden"))
                        $('#dd'+id).dropdown('toggle');
                }
                break;
        }
    }
}
function refreshDD(id){
    myApi('GET','object/'+id+'?JSON&F_'+id+'=%25'+byId(id).value+'%25','def_ref_dd');
}
$(document).ready(function(){
    if(getCookie('icon8')){
        byId('icon8').value=getCookie('icon8');
        icon8(byId('icon8').value);
    }
    if(getCookie('icon8color')){
        byId('icon8color').value=getCookie('icon8color');
        icon8color(byId('icon8color'));
    } else {
        $('#controls').toggleClass('hidden')
    }
});

var compactTogglerStyle =  `
@media screen and (max-width:800px){
    td, th {
        display: block;
        float: left;
        border: 1px solid #c8c8c8;
    }
    tr {
        border: 1px solid #c8c8c8;
    }
    thead {
        display: block;
        background-color: #fff;
        position: sticky;
        top: 0;
    }
    td div {
        min-height: 1.6rem;
        line-height: 1.6rem;
        white-space: normal;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 4; /* number of lines to show */
        -webkit-box-orient: vertical;
    }
    .clone-scroll-bar-wrap {
        pointer-events: none;
    }
`

var compactMode = (tableID) => {
    var table = document.getElementById(tableID)
    table.classList.add('table-sm')
    var tbHeader = table.childNodes[1]
    var tbBody = table.childNodes[3]
    var headerCollection = tbHeader.childNodes[1].childNodes
    var rowCollection = tbBody.childNodes
    var thWidthes = {};
    var tdWidthes = {};
    headerCollection.forEach((th, index) => {
        if (th.offsetWidth) {
            thWidthes[index] = th.offsetWidth;
        }
    })

    rowCollection.forEach((row, k) => {
        if (row.offsetWidth && !row.id.length) {
            row.childNodes.forEach((child, i) => {
                if (child.offsetWidth) {
                    if (!tdWidthes[i] || tdWidthes[i] < child.offsetWidth) {
                        tdWidthes[i] = child.offsetWidth
                    } 
                }
            })
            row.childNodes.forEach((child, i) => {
                if (child.offsetWidth && thWidthes[i] > child.offsetWidth) {
                    child.style.width = `${thWidthes[i]}px`
                } else if (headerCollection[i] && headerCollection[i].offsetWidth) {
                        headerCollection[i].style.width = `${tdWidthes[i]}px`
                }
            })
        }
    })
    var thNodes = document.querySelectorAll('#tb thead th');
    thNodes.forEach((node, index) => {
        if (thNodes[index + 1] && (thNodes[index + 1].offsetTop !== node.offsetTop)) {
            node.style.width = `${node.offsetWidth + (node.parentNode.offsetWidth - node.offsetWidth - node.offsetLeft)}px`
        } else if (index === thNodes.length - 1) {
            node.style.width = `${node.offsetWidth + (node.parentNode.offsetWidth - node.offsetWidth - node.offsetLeft)}px`
        }
    })
}

function fun2(id) {
    let table = document.getElementById(id);
    var style = document.createElement('style')
        if (!state) {
            style.innerText = compactTogglerStyle;
            document.head.appendChild(style)
            compactMode(id);
            compactMode(id);
            compactMode(id);
            recalculateTable('compact');
            state = true;
            table.classList.add("striped-table");
        }
        else {
            table.classList.add('table')
            document.head.removeChild(document.head.lastChild);
            recalculateTable();
            state = false;
        }
    }

window.addEventListener('load',function(){
    if(getCookie('table-sm'))
        tbCompact(true);
    Object.defineProperty(Array.prototype, 'chunk_inefficient', {
        value: function(chunkSize) {
          var array = this;
          return [].concat.apply([],
            array.map(function(elem, i) {
              return i % chunkSize ? [] : [array.slice(i, i + chunkSize)];
            })
          );
        }
      });
      recalculateTable();
});

if(byId("filter_row")){
    var filters=byId("filter_row").getElementsByTagName("input");
    for(i=0;i<filters.length;i++)
    	if(filters[i].value!="") {
    		filters[i].size=filters[i].value.length + 1;
    		$('.filter_row').removeClass('hidden');
    	}
}
<!-- Begin:_NoObj -->
else{
    byId('warn').innerHTML=t9n('[RU]Объект {_request_.f_u} не найден, вероятно, он был удален[EN]Object $id not found (it might be deleted)');
    byId('warn').classList.remove('hidden');
}
<!-- End:_NoObj -->
</script>
